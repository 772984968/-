<?phpnamespace api\controllers;use Yii;use lib\models\Channel;use lib\channel\gift;//直播控制器class ChannelController extends BasisController{    public $formName = '\lib\forms\ChannelForm';    //创建直播频道    public function actionCreate()    {        parent::baseAction($this->formName, 'create');    }    //关闭直播频道    public function actionDelete()    {        parent::baseAction($this->formName, 'delete');    }    //真播列表    public function actionList()    {        $isNext = Yii::$app->getRequest()->post('isNext');        $userId = Yii::$app->factory->getuser()->userId;        Channel::$key_name = "at_channel.iid";        $result = Channel::list($userId, $isNext, 'userinfo', 10);                foreach ($result as $key => $row) {        }        $this->success(['list'=>$result]);    }    //赠送礼物    public function actionSendGifts()    {        $userId = Yii::$app->factory->getuser()->userId;        $rq = Yii::$app->getRequest();        $receiverId = intval($rq->post('receiverId'));  //接收者ID        $payType = intval($rq->post('payType'))+1;        //礼物类型        $payNumber = intval($rq->post('payNumber'));      //礼物数量        if($result = gift::send($userId, $receiverId, $payType, $payNumber)) {            $this->success(['diamond'=>$result]);        } else {            $this->error(gift::$error);        }    }    //用户进入直播    public function actionInto()    {        $cid = Yii::$app->getRequest()->post('cid');        if(!$cid) {            $this->error('请输入聊天室ID');        }    }    //开始直播    public function actionBegin()    {        $user_id = Yii::$app->factory->getuser()->userId;        $rst = Channel::findOne(['user_id' => $user_id]);        if($rst) {            \lib\wyim\channel::changeStatus($rst['cid'], 1);        } else {            $this->error('您没有开直播');        }    }    //结束直播    public function actionFinish()    {        $user_id = Yii::$app->factory->getuser()->userId;        $rst = Channel::findOne(['user_id' => $user_id]);        if($rst) {            \lib\wyim\channel::changeStatus($rst['cid'], 0);            $this->success();        } else {            $this->error('您没有开直播');        }    }}