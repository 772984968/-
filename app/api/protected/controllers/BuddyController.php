<?phpnamespace api\controllers;use lib\models\Buddy;use Yii;use yii\extend\AdCommon;use lib\models\User;use lib\forms\BuddyForm;//好友控制器class BuddyController extends BasisController{    //添加    public function actionAdd() {    }    //移动    public function actionMove() {        parent::baseAction('\lib\forms\BuddyForm', 'move');    }    //删除    public function actionDelete() {        parent::baseAction('\lib\forms\BuddyForm', 'delete');    }    //申请加好友    public function actionApply(){        parent::baseAction('\lib\forms\BuddyForm', 'applyAdd');    }    //同意    public function actionAgree(){        parent::baseAction('\lib\forms\BuddyForm', 'agreeAdd');    }    //拒绝    public function actionRefuse(){        parent::baseAction('\lib\forms\BuddyForm', 'refuseAdd');    }    //网易好友列表    public function actionBuddylist() {        $model = new BuddyForm();        $model->user_id = Yii::$app->factory->getuser()->userId;        var_dump($model->buddylist());    }    //分组好友列表    public function actionList()    {        $user_id = Yii::$app->factory->getuser()->userId;                $buddyList = \lib\models\Buddy::getList($user_id);        $groupList = \lib\models\BuddyGroup::getList($user_id);                foreach($buddyList as $row) {            $groupList[$row['group_id']]['buddy'][] = $row['userinfo'];        }        foreach ($groupList as $key => $row) {            $groupList[$key]['number'] = isset($row['buddy']) ? (string)count($row['buddy']) : 0;        }        foreach($groupList as $key => $row) {            if(!empty($row['system_group_id'])) {                unset($groupList[$key]);                unset($row['system_group_id']);                array_unshift($groupList,$row);            }        }        $this->success(['list'=>array_values($groupList)]);    }    //查找已添加的好友    public function actionFind()    {        $key = Yii::$app->getRequest()->post('keyword');        if(!$key) {            $this->error('请输入关键字');        }        $uid = Yii::$app->factory->getuser()->userId;        $result = Buddy::find()            ->select('u.iid,u.nickname,u.head,u.llaccounts,u.wy_accid')            ->leftJoin('at_user as u','u.iid=at_buddy.buddy_id')            ->where("user_id=$uid AND (u.nickname like :keyword OR u.llaccounts like :keyword)", [':keyword'=>"$key%"])            ->asArray()            ->all();        if($result) {            $this->success(['list'=>$result]);        } else {            $this->error('用户不存在');        }    }}