<?phpnamespace lib\news;use Yii;use yii\simple_html_dom\simple_html_dom;use lib\models\HotHeadlines as HotHeadlinesModel;//新闻头条class HotHeadlines{    const APIURL = 'http://v.juhe.cn/toutiao/index';    const KEY = '1859b274d4247d02d483c120f9ecd185';    public static function getList($typename = '') : array    {        $url = static::APIURL . '?type='.$typename.'&key=' . static::KEY;        $result = Yii::$app->curl->get( $url );        $result = json_decode($result);        return $result->result->data ?? [];    }    //抓到详细内容,记录到数据库中    public static function getDetails($url)    {        $html = new simple_html_dom();        $html->load_file($url);        $endText = $html->find('div[id=content]');        if( empty($endText) ) {            return '';        }        $endText = $endText[0];        $htmlcontent = $endText->innertext;        $html->clear();        return $htmlcontent;    }    //把相关的图片字段，放到一个字段中，转成JSON返回    private static function getImages($new)    {        $images = [];        foreach($new as $key => $value) {            if(substr($key, 0, 9) === 'thumbnail') {                $images[] = $value;            }        }        return json_encode($images);    }    //把数据爬到数据库中    public static function creep( $typeArray )    {        foreach($typeArray as $type)        {            $newsList = static::getList($type['name_headline']);            if($newsList)            {                foreach($newsList as $new)                {                    if(HotHeadlinesModel::findOne(['other_id' => $new->uniquekey])) {                        continue;                    }                    $htmlContent = static::getDetails( $new->url );                    if(strlen($htmlContent) > 65535) {                        continue;                    }                    $model = new HotHeadlinesModel();                    $model->type_id = $type['iid'];                    $model->title = $new->title;                    $model->other_id = $new->uniquekey;                    $model->images = static::getImages($new);                    $model->content = $htmlContent;                    $model->source_time = $new->date;                    $model->url = $new->url;                    $model->save();                }            }        }    }}