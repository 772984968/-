<?phpnamespace lib\nodes;//通知消息use lib\wyim\wyim;use lib\models\User;use lib\models\UserNotice;use lib\nodes\UserNode;class Notice{    private static $user_id;    public static function send($to, array $data)    {        $data = json_encode($data);        $sendResut =  wyim::sendNotice([            'from' => '13043434556',            'msgtype' => '0',            'to' => $to,            'attach' => $data,        ]);        return $sendResut;    }    public static function applyAddBuddy($to, User &$user, array $extra=[]) {        $data = [            'title' => '请求请加好友',            'type' => 'buddy',            'operate' => 'apply',            'head' => UserNode::get_head_url($user->head),            'name' => $user->nickname,        ];        static::$user_id = $user->iid;        return static::handle($to, $data ,$extra);    }    public static function agreeAddBuddy($to, User $user, array $extra=[]) {        $data = [            'title' => '加好友成功',            'type' => 'buddy',            'operate' => 'agree',            'head' => UserNode::get_head_url($user->head),            'name' => $user->nickname,        ];        static::$user_id = $user->iid;        return static::handle($to, $data ,$extra);    }    public static function refuseAddBuddy($to, User $user, array $extra=[]) {        $data = [            'title' => '拒绝加好友',            'type' => 'buddy',            'operate' => 'refuse',            'head' => UserNode::get_head_url($user->head),            'name' => $user->nickname,        ];        static::$user_id = $user->iid;        return static::handle($to, $data ,$extra);    }    public static function wallet(User $user, $data) {        static::$user_id = $user->iid;        return static::handle($user->wy_accid, $data);    }    private static function handle($to, $data, $extra=[]) {        if( $extra ) {            $data = array_merge($data, $extra);        }        //发送信息        $sendResult = static::send($to, $data);        if( !$sendResult ) {            return false;        }        //把消息记录到数据库中        $type = $data['type'] ?? '';        $result = UserNotice::add([            'user_id' => static::$user_id,            'type' => (string)$type,            'content' => (string)json_encode($data),        ]);        return true;    }}/*[    'title' => '充值成功',    'time' => date('Y-m-d H:i:s'),    'content' => '1000钻石',    'describe' => ['付款帐户:联联平台','交易对象:我的现金帐户']]*/?>