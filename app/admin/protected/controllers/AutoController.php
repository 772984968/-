<?phpnamespace app\controllers;use yii\web\Controller;use yii\VideoCloud\Storage\UploadManager;use Yii;use lib\wyim\video;class AutoController extends Controller{    public function actionUploadwy()    {        $status = Yii::$app->getCache()->get('upload_wy_status');        if($status) {            die;        }        $model = \lib\models\VipVideo::find()->where("upload_status=0")->orderBy('id asc')->limit(1)->one();        if($model)        {            $model->upload_status = 3;            $model->save();            if(!is_file($model->local_address)) {                $model->upload_status = 2;                $model->save();                Yii::$app->getCache()->set('upload_wy_status', 0);                die;            }            $ret = video::upload( $model->local_address );            if (!$ret) {                $model->upload_status = 2;                $model->save();            } else {                $model->wy_name = $ret['objectName'] ?? '';                $model->wy_vid = $ret['vid'] ?? '';                $model->upload_status = 1;                unlink($model->local_address);                $model->save();            }            Yii::$app->getCache()->set('upload_wy_status', 0);            echo 'o';die;        }    }    public function actionTest()    {        echo 'hello';    }    public function actionUploadimage()    {        $url = 'http://appback.atkj6666.cn/upload/image';        $model = \lib\models\VipVideo::find()->where("upload_status_image=0")->orderBy('id asc')->limit(1)->one();        if($model)        {            $curl = new \lib\nodes\Curl();            $model->upload_status_image = 3;            $model->save();            //上传封面图片            if($model->cover_string && is_file($model->cover_string)) {                $result = $curl->upload_file($model->cover_string, $url);                if(isset($result->code) && $result->code==200) {                    $cover_string = $model->cover_string;                    $model->cover_string = $result->date->url;                } else {                    $model->upload_status_image = 2;                    $model->save();                    die;                }            }            $images = json_decode($model->thumbnail_json);            if($images && is_array($images)) {                $http_images = [];                foreach($images as $image) {                    $result = $curl->upload_file($image, $url);                    if(isset($result->code) && $result->code==200) {                        $http_images[] = $result->date->url;                    } else {                        $model->upload_status_image = 2;                        $model->save();                        die;                    }                }                $model->thumbnail_json = json_encode($http_images);            }            $model->upload_status_image = 1;            $model->save();            //删除本地图片            if($images)            {                foreach($images as $image)                {                    if(is_file($image)) unlink($image);                }            }            if( is_file($cover_string) ) {                unlink( $cover_string );            }        }    }    //添加到数据库中    public function actionInsertdb()    {    }}