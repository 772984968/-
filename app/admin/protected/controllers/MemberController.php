<?phpnamespace app\controllers;use app\library\ApppowerLibrary;use lib\models\Member;use yii\extend\AdCommon;use yii;//标签类class MemberController extends TemplateController{    public $config = [        'modelName' => 'lib\models\Member',        'modelShortName' => 'Member',        'addUrl' => 'memberAdd',        'listUrl' => 'memberManage',        'delUrl' => '',        'chgUrl' => 'memberEdit',        'addTitle' => '添加',        'addFormName' => '参数',        'chgTitle' => '修改',        'chgFormName' => '参数',        'listTitle' => '标签列表',        'listFormName' => '参数',    ];        //可搜索的选项    public function getSearch()    {        return [        ];    }    //添加修改中定主的字段    protected function getOption()    {        return [            ['key'=>'name','value'=>'','html'=>'text','option'=>''],            ['key'=>'price','value'=>'','html'=>'text','option'=>''],            ['key'=>'invite_price','value'=>'','html'=>'text','option'=>''],            ['key'=>'friend_number','value'=>'','html'=>'text','option'=>''],            ['key'=>'flock_number','value'=>'','html'=>'text','option'=>''],            ['key'=>'flock_peopel_number','value'=>'','html'=>'text','option'=>''],            ['key'=>'is_default','value'=>'','html'=>'radio','option'=>['0'=>'否','1'=>'是']],        ];    }    /**     * [actionIndex 添加]     * @return [type] [description]     */    public function actionAdd()    {        if( $this->isPost() )        {            $data = $this->post( $this->config['modelShortName'] );            $pPower = $this->post('power');            $sPower = $this->post('powerid');            $rolePower = implode(',', array_merge((array)$pPower, (array)$sPower));            $data['operates'] = $rolePower;            $model = new $this->config['modelName'];            $model->attributes = $data;            $model->save();            if(empty($model->errors))            {                $this->success(\yii::t('app', 'success'), \yii::$app->params['url'][$this->config['listUrl']]);            }            else            {                $this->error(AdCommon::modelMessage($model->errors));            }        }        $this->data['fieldOption'] = $this->getOption();        $this->data['config']= $this->config;        $menu = ApppowerLibrary::app()->getUserMenu();        $this->data['menu'] = ApppowerLibrary::app()->powerHtml($menu);        return $this->view('window');    }    /**     * [actionIndex 修改]     * @return [type] [description]     */    public function actionChange()    {        $id = $this->get('id');        if ( empty($id) ){            $this->error(\Yii::t('app', 'error'));        }        $model = $this->config['modelName']::findOne($id);        if ($this->isPost())        {            $data = $this->post( $this->config['modelShortName'] );            $pPower = $this->post('power');            $sPower = $this->post('powerid');            $rolePower = implode(',', array_merge((array)$pPower, (array)$sPower));            $data['operates'] = $rolePower;            $model->attributes = $data;            if ($model->save())            {                $this->success(\Yii::t('app', 'success'), \yii::$app->params['url'][$this->config['listUrl']]);            }            else            {                $this->error(AdCommon::modelMessage($model->errors));            }        }        $setting = $this->getOption();        foreach($setting as $k => $v)        {            $setting[$k]['value'] = $model[$v['key']];        }        #角色权限        $rolePower = explode(',', $model['operates']);        $menu      = ApppowerLibrary::app()->getUserMenu();        $this->data['menu'] = ApppowerLibrary::app()->powerHtml($menu, $rolePower);        $this->data['fieldOption'] = $setting;        $this->data['config'] = $this->config;        return $this->view('window');    }    //主页中显示的字段名    public function getIndexField()    {        return [            'iid',            'name',            'price',            'invite_price',            'friend_number',            'flock_number',            'flock_peopel_number',            'is_default',        ];    }}?>