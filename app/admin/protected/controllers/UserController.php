<?phpnamespace app\controllers;use lib\models\User;use yii;//用户控制器class UserController extends TemplateController{    public $config = [        'modelName' => 'lib\models\User',        'modelShortName' => 'User',        'listUrl' => 'UserManage',        'addUrl' => '',        'delUrl' => '',        'chgUrl' => 'UserManageEdit',        'addTitle' => '添加',        'addFormName' => '参数',        'chgTitle' => '修改',        'chgFormName' => '参数',        'listTitle' => '标签列表',        'listFormName' => '参数',    ];    //可搜索的选项    public function getSearch()    {        return [        ];    }    public function actionIndex()    {        $this->data['search'] = $this->getSearch();        $this->setIndexData();        $this->data['config'] = $this->config;        $this->data['title'] = $this->getIndexField();        return $this->view('index');    }    //添加修改中定主的字段    protected function getOption()    {        $list = array_merge(['0'=>'请选择'],\lib\models\Agent::getKeyName());        return [            ['key'=>'username','value'=>'','html'=>'text','option'=>'','changedisabled'=>1],            ['key'=>'agent','value'=>'','html'=>'select','option'=>$list],        ];    }    //主页中显示的字段名    public function getIndexField()    {        return [            'iid',            'username',            'llaccounts',            'vip_type',            'agentinfo',            'inviteCode',            'created_at',            'wallet',            'diamond',        ];    }    //设置首页显示的数据    protected function setIndexData()    {        $search = $this->get('search');        $where  = '1=1';        $where_keyword = [];        //搜索        if(!empty($search['type']) && !empty($search['keyword']))        {            $where .= " and " . $search['type'] ." like :like";            $where_keyword = [':like'=>"%{$search['keyword']}%"];        }        //添加时间搜索        if(!empty($search['stime']))        {            $stime = strtotime($search['stime']);            $etime = empty($search['etime']) ? time() : strtotime($search['etime']);            $where .= " and UNIX_TIMESTAMP(create_time) between " . $stime ." and " . $etime;        }        $query = $this->config['modelName']::find()            ->with(['agentinfo','memberinfo'])            ->where($where,$where_keyword);        $this->data['count'] = $query->count();        $this->data['page']  = $this->page( $this->data['count'] );        $data = $query->asArray()->all();        foreach($data as $key => $row) {            $data[$key]['agentinfo'] = $row['agentinfo']['name'] ?? '';            $data[$key]['vip_type'] = $row['memberinfo']['name'] ?? '';        }        $this->data['data']  = $data;        $this->data['searchvalue'] = $search;    }    public function actionClearmemberone()    {        $uid = Yii::$app->getRequest()->get('uid');        $sql = "UPDATE at_user set vip_type=0,vip_start='0000-00-00',vip_end='0000-00-00' WHERE iid=$uid";        Yii::$app->getDb()->createCommand($sql)->execute();        $this->success(\yii::t('app', 'success'), \yii::$app->params['url'][$this->config['listUrl']]);    }}?>